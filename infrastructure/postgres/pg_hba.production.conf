# PostgreSQL Production Host-Based Authentication Configuration
# ============================================================
# SECURITY: This configuration REQUIRES SSL for all remote connections

# TYPE  DATABASE        USER            ADDRESS                 METHOD              OPTIONS

# Local connections (within container only)
local   all             postgres                                peer
local   all             all                                     scram-sha-256

# Reject all non-SSL connections
host    all             all             0.0.0.0/0               reject
host    all             all             ::/0                    reject

# IPv4 SSL connections
# Application connections - require SSL with password
hostssl memecoin_lending memecoin       10.0.0.0/8              scram-sha-256
hostssl memecoin_lending memecoin       172.16.0.0/12           scram-sha-256
hostssl memecoin_lending memecoin       192.168.0.0/16          scram-sha-256

# Admin connections - require SSL with client certificate
hostssl all             postgres        0.0.0.0/0               cert clientcert=verify-full

# Backup user - require SSL with password
hostssl memecoin_lending backup         172.20.0.0/16           scram-sha-256

# Monitoring user (if needed) - require SSL
hostssl postgres        monitoring      10.0.0.0/8              scram-sha-256

# IPv6 SSL connections (if enabled)
hostssl memecoin_lending memecoin       ::1/128                 scram-sha-256
hostssl memecoin_lending memecoin       fe80::/10               scram-sha-256

# Replication connections (if needed)
# hostssl replication    replicator      10.0.0.0/8              scram-sha-256 clientcert=verify-ca

# Deny all other connections
hostssl all             all             0.0.0.0/0               reject
hostssl all             all             ::/0                    reject